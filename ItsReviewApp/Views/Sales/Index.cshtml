@model ItsReviewApp.ViewModels.LeadViewModel
@{
    ViewBag.Title = "Index";
}


<div class="container">
    <p>
        <a class="btn btn-primary btn-sm" href="/Sales/Create" type="button">Create New</a>
        <button class="btn btn-primary btn-sm" type="button" id="checksaleslist">SalesList</button>
        <button class="btn btn-primary btn-sm" type="button" id="checkfollowup">FollowUpdateList</button>
        <button class="btn btn-primary btn-sm" type="button" id="LeadExcelUpload">Excel Upload</button>
    </p>
</div>

<div class="container" style="margin-top: 30px;" id="saleslist">
    <div class="form-group">
        <table id="datatableid" class="table table-bordered table-responsive" style="width: 100%">
            <thead>
                <tr>
                    <th style="Width:15%;">Phone Number</th>
                    <th style="Width:40%;">Company Name</th>
                    <th style="Width:15%;">CIty Name</th>
                    <th style="Width:15%;">Listing Url</th>
                    <th style="Width:10%;">Rev/Day</th>
                    <th style="Width:5%;"></th>
                </tr>
            </thead>
        </table>
    </div>
</div>



<div class="container" style="margin-top: 30px;display:none" id="followuplist">
    <div class="form-group">

        <table id="followup" class="table table-bordered table-responsive" style="width: 100%">
            <thead>
                <tr>
                    <th>Customer Name</th>
                    <th>Phone Number</th>
                    <th>FollowUp Date</th>
                    <th>Remarks</th>
                    <th></th>
                </tr>
            </thead>
        </table>
    </div>
</div>

<div class="container" style="margin-top: 30px; display: none; background-color: rgb(47 79 79 / 5%); " id="LeadDataUpload">
    <div class="form-group">
        <label for="Name">Select Client Name</label>
        @Html.DropDownList("Name", (IEnumerable<SelectListItem>)ViewBag.Client, "-- Select Client --", new { @class = "form-control clientname", onchange = "EnableExcel(this)" })
    </div>

    <div class="form-group">
        <label for="ExcelUpload">Upload File</label>
        <input type="file" id="files" name="files" /><br />
        <input type="button" id="excelupload" value="Upload" class="btn btn-primary btn-md btn-sm" disabled/>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        BindSales();
    });

    function BindSales() {
        $.ajax({
            url: "GetList/Sales",
            type: "GET",
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $('#datatableid').dataTable({
                    destroy: true,
                    data: data,
                    "columns": [
                        { "data": "PhoneNumber" },
                        { "data": "CompanyName"},
                        { "data": "CityName" },
                        {
                            "data": "ListingUrl",
                            "render": function (data) {
                                return '<a class="btn btn-primary" target="_blank" href="'+data+'">Company URL</a>';
                            }
                        },
                    { "data": "ReviewsPerDay" },
                        {
                            "data": "Id",
                            "render": function (data, type, row) {
                                return '<a class="btn btn-primary" href="Create/Id?=' + data + '";>Edit</a>';
                            }
                        }
                    ]
                });

            }
        })
    }


    function BindFollwUp() {
        $.ajax({
            url: "GetFollowUpList/Sales",
            type: "GET",
            dataType: "json",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                $('#followup').dataTable({
                    destroy: true,
                    data: data,
                    "columns": [
                        { "data": "ClientName" },
                        { "data": "PhoneNumber" },
                        {
                            "data": "FollowUpDate",
                            "render": function (data) {
                                const dateValue = new Date(parseInt(data.substr(6)));
                                return dateValue.toLocaleDateString();
                            }
                        },
                        { "data": "Remarks" },
                        {
                            "data": "Id",
                            "render": function (data, type, row) {
                                return '<a href="Create/Id?=' + data + '";>Edit</a>';
                            }
                        }
                    ]
                });

            }
        })
    }

    $("#checkfollowup").click(function () {
        $("#saleslist").hide();
        $("#followuplist").show(BindFollwUp());
        $("#LeadDataUpload").hide();
    });


    $("#checksaleslist").click(function () {
        $("#followuplist").hide();
        $("#saleslist").show();
        $("#LeadDataUpload").hide();
    });

    $("#LeadExcelUpload").click(function () {
        $("#followuplist").hide();
        $("#saleslist").hide();
        $("#LeadDataUpload").show();
    });

     $('#excelupload').click(function () {
         var registerId = $(".clientname").val();
        var fileUpload = $("#files").get(0);
         var files = fileUpload.files;
         if (files.length == 0) {
             alert("Please Upload a file");
             return
         }
         var fileData = new FormData();
         fileData.append('RegisterId', registerId);
        for (var i = 0; i < files.length; i++) {
            fileData.append(files[i].name, files[i]);
        }

         
        
        $.ajax({
            url: "@Url.Action("Upload", "Sales")",
           type: "POST",
           processData: false,
           contentType: false,
             data: fileData,
            success: function (result) {
                $("#files").val('');
                $(".clientname").val('');
                alert(result);
                $('#excelupload').prop("disabled", true);
            },
            error: function (result) {
                alert('failure');
            }
        });
     })

    function EnableExcel(name) {
        if (name.value != 0 || name.value != "") {
            $('#excelupload').prop("disabled", false);
        }
        else {
            $('#excelupload').prop("disabled", true);
        }

    }
</script>
