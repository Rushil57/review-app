@{
    ViewBag.Title = "Create";

}

<!DOCTYPE html>
<html>
<head>
    <link href="~/Content/Site.css" rel="stylesheet" />
</head>
<body>
    <div class="container-fluid">
        <div class="header">
            <h5 style="color:#fff;margin-right: 40px;">ItsReview App</h5>
        </div>

    </div>
    <div class="container" style="margin-top:30px;">
        <div class="row col-md-12">
            <div class="form-group col-md-3" id="nicheid">
                <label>Select Niche: </label>
                <div>
                    @Html.DropDownList("MySkills", (IEnumerable<SelectListItem>)ViewBag.MySkills, new { @class = "form-control chosen" })
                </div>
            </div>
            <div class="form-group col-md-3" id="countryid">
                <label>Select Country: </label>
                <div>
                    @Html.DropDownList("Country", (IEnumerable<SelectListItem>)ViewBag.Country, new { @class = "form-control chosen" })
                </div>
            </div>
            <div class="form-group col-md-3" id="typeid">
                <label>Select Type: </label>
                <div>
                    @Html.DropDownList("Type", (IEnumerable<SelectListItem>)ViewBag.Type, new { @class = "form-control chosen" })
                </div>
            </div>
            <div class="form-group col-md-3" id="companyid">
                <label>Select Company: </label>
                <div>
                    @Html.DropDownList("CompanyName", (IEnumerable<SelectListItem>)ViewBag.Company, new { @class = "form-control chosen" })
                </div>
            </div>
        </div>

        <div class="row col-md-12">
            <div class="form-group col-md-8">
                <label>Enter Review: </label>
                <input type="button" class="btn btn-dark" value="Add New Row" id="newrows" style="margin-left:30px;" />
                <div style="padding-top:10px;">
                    <table class="table table-bordered" id="reviewtableid">
                        <thead>
                            <tr>
                                <th scope="col">Review</th>
                            </tr>
                        </thead>
                        <tbody class="ReviewTableClass">
                            <tr>
                                <td>
                                    <input type="text" placeholder="Enter Review" class="name form-control" value="" onfocusout="ReviewValidation(this)" id="fname" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="text" placeholder="Enter Review" class="name form-control" onfocusout="ReviewValidation(this)" value="" />
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <button type="button" id="btnSubmit" class="btn btn-primary btn-md btn-sm">Save</button>
                   
                </div>
            </div>
        </div>
    </div>
</body>
</html>

<script type="text/javascript">
    $(document).ready(function () {
        var count = 2;
        $("#newrows").click(function () {
            count++;
            var addcontrols = "<tr id=\"RowId_" + count + "\">" + count + ">"
            addcontrols += "<td><input type='text' onfocusout='ReviewValidation(this)' name='reviewname' placeholder='Enter Review' class='name form-control'></td>"
            addcontrols += "</tr>";
            $("table tbody").append(addcontrols);
        });

    })


    $('#btnSubmit').click(function () {
        var CompanyId = $("#companyid option:selected").val();

        var Reviews = new Array();
        $("#reviewtableid tbody tr").each(function () {

            var row = $(this);
            var Review = {};
            Review.ReviewName = row.find("td:eq(0) input[type='text']").val();
            Reviews.push(Review);
        });

        var writeobject = new Object();
        writeobject.CompanyId = CompanyId,
        writeobject.Reviews = Reviews;

        $.ajax({
            url: 'Create/Writer',
            contentType: 'application/json',
            data: JSON.stringify(writeobject),
            type: "POST",
            success: function () {
                alert('success');
            },
            error: function () {
                alert('failure');
            }
        });
    });

    $(function () {
        $(".chosen").chosen();
    });

    function ReviewValidation(review) {

        var reviewName = review.value;
        if (reviewName == null || reviewName == "") {
            return;
        }
        $.ajax({
            /*   url: 'GetUserData/Writer',*/
            url: "@Url.Action("GetUserData", "Writer")",
            contentType: 'application/json',
            data: { "reviewName": reviewName},
            type: "GET",
            success: function (data) {
                if(data.toUpperCase() == "TRUE"){
                    review.value = "";
                    alert('Review already exists');
                }
            },
            error: function () {
                alert('failure');
            }
        });
    }


</script>


